(this["webpackJsonpkeeper-app-part-1-starting"]=this["webpackJsonpkeeper-app-part-1-starting"]||[]).push([[0],{12:function(e,t,a){e.exports=a(25)},25:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),r=a(8),l=a.n(r),i=a(2);var s=function(e){return o.a.createElement("header",null,o.a.createElement("h1",null,"Keeper",e.isLogin?o.a.createElement("button",{className:"header-item",onClick:e.onLogout},"Logout"):o.a.createElement("button",{className:"header-item",onClick:e.onLogout},"Login")))};var c=function(){var e=(new Date).getFullYear();return o.a.createElement("footer",null,o.a.createElement("p",null,"Copyright \u24d2 ",e))},u=a(9),m=a.n(u);var p=function(e){return o.a.createElement("div",{className:"note"},o.a.createElement("h1",null,e.name),o.a.createElement("p",null,e.description),o.a.createElement("button",{onClick:function(){return t=e.id,void fetch("https://authapi-264513.appspot.com/posts/"+t,{method:"DELETE",headers:{Authorization:"Bearer "+e.token}}).then((function(e){if(200!==e.status&&201!==e.status)throw new Error("Deleting a post failed!");return e.json()})).then((function(t){e.loadPost()})).catch((function(e){}));var t}}," ",o.a.createElement(m.a,null)))},d=a(1),h=a(4);var f=function(e){var t=Object(n.useState)({name:"",description:""}),a=Object(i.a)(t,2),r=a[0],l=a[1];function s(e){var t=e.target,a=t.name,n=t.value;l((function(e){return Object(h.a)({},e,Object(d.a)({},a,n))}))}return o.a.createElement("div",null,o.a.createElement("form",null,o.a.createElement("input",{name:"name",onChange:s,value:r.name,placeholder:"Post name"}),o.a.createElement("textarea",{name:"description",onChange:s,value:r.description,placeholder:"Take a description...",rows:"3"}),o.a.createElement("button",{onClick:function(t){t.preventDefault();var a=JSON.stringify({name:r.name,description:r.description});console.log(a),fetch("https://authapi-264513.appspot.com/posts",{method:"POST",headers:{Authorization:"Bearer "+e.token,"Content-Type":"application/json"},body:JSON.stringify({name:r.name,description:r.description})}).then((function(t){if(200!==t.status&&201!==t.status)throw new Error("Creating a post failed!");return e.loadPost(),t.json()})).then((function(e){l({name:"",description:""})})).catch((function(e){l({name:"",description:""})}))}},"Add")))};var g=function(e){var t=Object(n.useState)({email:"",password:""}),a=Object(i.a)(t,2),r=a[0],l=a[1];function s(e){var t=e.target,a=t.name,n=t.value;l((function(e){return Object(h.a)({},e,Object(d.a)({},a,n))}))}return o.a.createElement("div",null,o.a.createElement("form",{onSubmit:function(t){e.onLogin(t,{email:r.email,password:r.email})}},o.a.createElement("h1",{className:"h1-items"},"Login"),o.a.createElement("hr",null),o.a.createElement("label",null,"email"),o.a.createElement("input",{name:"email",onChange:s,value:r.email,placeholder:"\u8f38\u5165 email"}),o.a.createElement("label",null,"password"),o.a.createElement("input",{name:"password",onChange:s,value:r.password,placeholder:"\u8f38\u5165 password"}),o.a.createElement("button",{type:"submit"},"Login")))};var E=function(e){var t=Object(n.useState)({name:"",email:"",password:""}),a=Object(i.a)(t,2),r=a[0],l=a[1];function s(e){var t=e.target,a=t.name,n=t.value;l((function(e){return Object(h.a)({},e,Object(d.a)({},a,n))}))}return o.a.createElement("div",null,o.a.createElement("form",{onSubmit:function(t){e.onSignup(t,{name:r.name,email:r.email,password:r.email})}},o.a.createElement("h1",{className:"h1-items"},"SignUp"),o.a.createElement("hr",null),o.a.createElement("label",null,"name"),o.a.createElement("input",{name:"name",onChange:s,value:r.name,placeholder:"\u8f38\u5165 name"}),o.a.createElement("label",null,"email"),o.a.createElement("input",{name:"email",onChange:s,value:r.email,placeholder:"\u8f38\u5165 email"}),o.a.createElement("label",null,"password"),o.a.createElement("input",{name:"password",onChange:s,value:r.password,placeholder:"\u8f38\u5165 password"}),o.a.createElement("button",{type:"submit"},"Signup")))};var v=function(){var e=Object(n.useState)({isAuth:!1,token:null,userId:null,error:null,msg:""}),t=Object(i.a)(e,2),a=t[0],r=t[1],l=Object(n.useState)({posts:[],error:""}),u=Object(i.a)(l,2),m=u[0],d=u[1];function h(e){setTimeout((function(){v()}),e)}function v(){r({isAuth:!1,token:null}),localStorage.removeItem("token"),localStorage.removeItem("expiryDate"),localStorage.removeItem("userId")}function w(){fetch("http://https://authapi-264513.appspot.com").then((function(e){if(200!==e.status)throw new Error("Failed to fetch posts");return e.json()})).then((function(e){console.log("resData ="+e.posts),d({posts:e.posts})})).catch((function(e){console.log("err="+e),d({error:e})}))}return Object(n.useEffect)((function(){var e=localStorage.getItem("token"),t=localStorage.getItem("expiryDate");if(e&&t)if(new Date(t)<=new Date)v();else{var a=localStorage.getItem("userId"),n=new Date(t).getTime()-(new Date).getTime();r({isAuth:!0,token:e,userId:a}),w(),h(n)}}),[]),o.a.createElement("div",null,o.a.createElement(s,{isLogin:a.isAuth,onLogout:v}),o.a.createElement("p",null,a.msg),a.isAuth&&o.a.createElement(f,{loadPost:w,token:a.token}),!a.isAuth&&o.a.createElement("div",null,o.a.createElement(g,{onLogin:function(e,t){e.preventDefault(),w(),fetch("https://authapi-264513.appspot.com/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t.email,password:t.password})}).then((function(e){if(422===e.status)throw new Error("Validation failed");if(200!==e.status&&201!==e.status)throw new Error("Could not authenticate you");return e.json()})).then((function(e){r({isAuth:!0,token:e.token,userId:e.user._id}),localStorage.setItem("token",e.token),localStorage.setItem("userId",e.user._id);var t=new Date((new Date).getTime()+36e5);localStorage.setItem("expiryDate",t.toISOString()),h(36e5)})).catch((function(e){r({isAuth:!1})}))}}),o.a.createElement(E,{onSignup:function(e,t){e.preventDefault(),fetch("https://authapi-264513.appspot.com/auth/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t.name,email:t.email,password:t.password})}).then((function(e){if(422===e.status)throw new Error("Validation failed. Make sure the email address isn't used yet!");if(200!==e.status&&201!==e.status)throw console.log("Error!"),new Error("Creating a user failed!");return e.json()})).then((function(e){r({msg:"SignUp Success"})})).catch((function(e){r({msg:"Error"})}))}})),m.posts.map((function(e){return o.a.createElement(p,{loadPost:w,key:e._id,id:e._id,name:e.name,description:e.description,token:a.token})})),o.a.createElement(c,null))};l.a.render(o.a.createElement(v,null),document.getElementById("root"))}},[[12,1,2]]]);
//# sourceMappingURL=main.3a12292c.chunk.js.map